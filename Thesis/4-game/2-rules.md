## Κανόνες παιχνιδιού {#sec:game:rules}

### Βασικοί κανόνες {#sec:game:rules:basic}

Σε αυτήν την Ενότητα θα παρουσιάσουμε το παιχνίδι που κατασκευάστηκε και θα εξηγήσουμε τους κανόνες του. Ένα στιγμιότυπο της οθόνης του παιχνιδιού, φαίνεται στην *Εικόνα @fig:game:rules:basic:gamescreen*.

![Στιγμιότυπο του παιχνιδιού «Parking Game».](4-game/figures/gamescreen.png){#fig:game:rules:basic:gamescreen width=75%}

Παρατηρούμε πως ο χάρτης του παιχνιδιού αποτελεί έναν χώρο στάθμευσης (*parking lot*). Ο χώρος αυτός, περιέχει 10 θέσεις στάθμευσης (*parking spots*), οι οποίες διακρίνονται από τις άσπρες γραμμές στο έδαφος του. Σε κάθε επεισόδιο του παιχνιδιού, μία από αυτές τις θέσεις θα είναι ελεύθερη και τα όρια της θα καθορίζονται από ένα κόκκινο παραλληλόγραμμο. Ο πράκτορας ελέγχει το κόκκινο αυτοκίνητο και ξεκινάει κάθε φορά από τυχαία θέση στον χάρτη και γωνία προσανατολισμού. Στόχος του, είναι να παρκάρει το αυτοκίνητο στην ελεύθερη θέση στάθμευσης. Τότε, ο πράκτορας κερδίζει και ξεκινάει καινούργιο επεισόδιο. Αντίθετα, αν περάσουν 30 δευτερόλεπτα χωρίς να καταφέρει ο πράκτορας να παρκάρει το αυτοκίνητο, τότε χάνει και ξεκινάει καινούργιο επεισόδιο.

Αξίζει να διευκρινίσουμε τι ορίζεται ως επιτυχής στάθμευση στο παιχνίδι. Ο πράκτορας θεωρείται ότι έχει παρκάρει επιτυχώς, όταν το αυτοκίνητο του βρίσκεται μέσα στη θέση στάθμευσης (δηλαδή εντός του αντίστοιχου κόκκινου παραλληλογράμμου) και παραμείνει ακίνητο για το χρονικό διάστημα των 2 δευτερολέπτων. Αυτές οι προϋποθέσεις είναι πολύ πιο αυστηρές από αυτές που χρησιμοποιούνται στα περισσότερα περιβάλλοντα αυτόματης στάθμευσης. Για παράδειγμα, στην εργασία των [@Mujumdar], θεωρείται επιτυχής στάθμευση, αμέσως μόλις ο πράκτορας αγγίξει το παραλληλόγραμμο της θέσης στάθμευσης. Αντίστοιχα, στην εργασία του [@LaiAutoparking2018], αρκεί ο πράκτορας να εισέλθει στο παραλληλόγραμμο της θέσης στάθμευσης, χωρίς να απαιτείται κάποιο χρονικό διάστημα ακινησίας. Ωστόσο, οι συνθήκες που επιλέχθηκαν, αντικατοπτρίζουν πιο πιστά την πραγματική διαδικασία στάθμευσης και αποτελούν μεγαλύτερη πρόκληση για τον πράκτορα.

Ακόμα, το παιχνίδι υποστηρίζει τις συγκρούσεις μεταξύ του πράκτορα και των υπολοίπων στοιχείων του χάρτη. Τα στοιχεία αυτά μπορεί να είναι:

- τα υπόλοιπα, σταθμευμένα αυτοκίνητα
- ο κήπος που βρίσκεται στο κέντρο του χάρτη
- η περίμετρος (τα όρια) του χάρτη

Η περίπτωση της σύγκρουσης γίνεται κατανοητή από τους ανθρώπινους παίκτες, καθώς απεικόνιζεται προσωρινά με κόκκινο χρώμα η περιοχή του αντικειμένου με το οποίο συγκρούστηκε το αυτοκίνητο, ενώ ακούγεται κι ένας σχετικός ήχος, με ένταση ανάλογη της ταχύτητας της σύγκρουσης. Τότε, ο πράκτορας θα κινηθεί στιγμιαία προς την αντίθετη κατεύθυνση, με την ταχύτητα της σύγκρουσης του κι ύστερα θα ακινητοποιηθεί. Έπειτα, είναι ελεύθερος να μετακινηθεί ξανά. Επομένως, το επεισόδιο δεν σταματάει στην πρώτη σύγκρουση του πράκτορα, όπως γίνεται στις περισσότερες εργασίες αγώνων ταχύτητας (π.χ. στο [@youtubeAILearns2] ή στο [@youtubeAILearns]). Αντίθετα, το παιχνίδι είναι πιο ανεκτικό στις συγκρούσεις, καθώς στην πράξη, αυτή η στρατηγική αποδείχθηκε πιο αποτελεσματική (βλ. υποενότητα @sec:training:ppo:overview).

Το αυτοκίνητο ελέγχεται με τα βέλη του πληκτρολογίου (UP, DOWN, LEFT, RIGHT), τα οποία χειρίζεται είτε ο άνθρωπος, είτε ο πράκτορας, ανάλογα με την έκδοση του παιχνιδιού που χρησιμοποιείται. Συνολικά, ο τρόπος κίνησης του αυτοκινήτου προσωμοιώνει -σε βαθμό ικανοποιητικό, για τα δεδομένα ενός παιχνιδιού- την πραγματική κίνηση ενός οχήματος.

Επιπλέον, στην *Εικόνα @fig:game:rules:basic:gamescreen*, διακρίνονται επίσης οι ακτίνες (*raycasts*) του αυτοκινήτου, οι οποίες λειτουργούν ως αισθητήρες (*sensors*) για τον πράκτορα, μετρώντας τις αποστάσεις του από τα υπόλοιπα αντικείμενα στον χάρτη. 

Τέλος, με βάση τη λειτουργία που περιγράψαμε, καθώς και τα όσα αναλύθηκαν στην υποενότητα @sec:theory:reinforcement_learning:concepts, το περιβάλλον του παιχνιδιού μπορεί να χαρακτηριστεί ως πλήρως παρατηρήσιμο, αιτιοκρατικό, συνεχές, μονοπρακτορικό, επεισοδιακό και με αραιές ανταμοιβές.

### Γενίκευση {#sec:game:rules:generalization}

Μία άλλη σημαντική έννοια που πρέπει να αναλογιστούμε, είναι η γενίκευση (*generalization*) του πράκτορα, δηλαδή η ικανότητα του να παρκάρει σε κάθε περίπτωση, ανεξαρτήτων των συνθηκών. Για τη γενίκευση στο παίχνιδι αυτό, παίζουν ρόλο δύο παράγοντες:

1. η αρχική θέση (και γωνία) του πράκτορα και
1. η επιλογή της ελεύθερης θέσης στάθμευσης

Συγκεκριμένα, μέσα από εμπειρικές παρατηρήσεις, καταλήξαμε στα παρακάτω συμπεράσματα για τους διαφορετικούς συνδυασμούς των δύο αυτών παραμέτρων κατά την εκπαίδευση:

1. Όταν είναι καθορισμένες (*fixed*) η αρχική θέση του πράκτορα και η θέση στάθμευσης, τότε ο πράκτορας δεν μαθαίνει να παρκάρει, αλλά αποστηθίζει μία συγκεκριμένη ακολουθία ενεργειών. Με άλλα λόγια, ο πράκτορας απλώς μαθαίνει μία δεδομένη «χορογραφία», (π.χ. UP, UP, LEFT, LEFT, DOWN, RIGHT) και εκτελεί αυτήν την αλληλουχία ενεργειών κάθε φορά. Έτσι, όταν μετά την εκπαίδευση, ο πράκτορας κληθεί να παρκάρει υπό διαφορετικές παραμέτρους, δεν είναι σε θέση να το κάνει, καθώς έχει υπερπροσαρμοστεί (*overfitting*) στις συγκεκριμένες συνθήκες της εκπαίδευσης του.
1. Όταν είναι καθορισμένη η αρχική θέση του πράκτορα, αλλά τυχαία η θέση στάθμευσης, συμβαίνει το ίδιο. Η μόνη διαφορά είναι πως ο πράκτορας θα αποστηθίσει 10 διαφορετικές ακολουθίες ενεργειών και θα εκτελεί την κάθε μία, ανάλογα με την αρχική κατάσταση του.
1. Όταν είναι τυχαία η αρχική θέση του πράκτορα, αλλά καθορισμένη η θέση στάθμευσης, τότε ο πράκτορας πετυχαίνει ένα μερικό βαθμό γενίκευσης. Συγκεκριμένα, όταν μετά την εκπαίδευση, κληθεί να παρκάρει σε μία διαφορετική θέση στάθμευσης, τότε είναι σε θέση να το κάνει, αλλά με μικρότερο ποσοστό επιτυχίας. Αυτό οφείλεται στο ότι οι νέες θέσεις στάθμευσης, ενδέχεται να φέρουν τον πράκτορα σε καταστάσεις με τιμές πολύ διαφορετικές από αυτές που είχε εκπαιδευτεί και τότε, ο πράκτορας δεν καταφέρνει να παρκάρει. Αντίθετα, όταν οι καταστάσεις είναι παρόμοιες με αυτές της εκπαίδευσης του, καταφέρνει να παρκάρει, ακόμα και αν δεν είχε συναντήσει ποτέ, ακριβώς την ίδια κατάσταση στην εκπαίδευση του.
1. Όταν είναι τυχαίες η αρχική θέση του πράκτορα και η θέση στάθμευσης, τότε ο πράκτορας μαθαίνει πραγματικά να παρκάρει κάτω από οποιεσδήποτε συνθήκες.

Επομένως, το μεγαλύτερο επίπεδο γενίκευσης επιτυγχάνεται, όταν ο πράκτορας ξεκινάει από τυχαία θέση και η επιλογή της θέσης στάθμευσης γίνεται τυχαία. Για αυτό και επιλέχθηκαν αυτές οι συνθήκες, στους βασικούς κανόνες του παιχνιδιού, όπως είδαμε προηγουμένως.

### Επίπεδα δυσκολίας {#sec:game:rules:difficulty}

Στην πράξη, αποδείχθηκε πως οι κανόνες του παιχνιδιού, όπως τους περιγράψαμε νωρίτερα, ήταν πολύ δύσκολοι για τους πράκτορες, για να πετύχουν ικανοποιητικά αποτελέσματα. Μία πρακτική λύση που προτείνεται σε τέτοιες περιπτώσεις, είναι η χρήση επιπέδων δυσκολίας. Αυτή η τακτική, διευκολύνει τη σωστή ρύθμιση του συστήματος από τον σχεδιαστή του, καθώς και επιτρέπει στον πράκτορα να εκπαιδευτεί πρώτα σε πιο εύκολες συνθήκες και στη συνέχεια να προχωρήσει σε πιο δύσκολες (*Curriculum Learning*). Θα αναλύσουμε περαιτέρω αυτές τις τεχνικές στην Ενότητα @sec:training:tips, όπου θα εξετάσουμε ορισμένες πρακτικές συμβουλες για την καλύτερη εκπαίδευση των πρακτόρων. Προς το παρόν, ας δούμε τα διαφορετικά επίπεδα δυσκολίας που χρησιμοποιήθηκαν στο παιχνίδι μας, και τις τροποποιήσεις του καθενός στους βασικούς κανόνες του παιχνιδιού:

- **Επίπεδο δυσκολίας 1** - *Σταθερή θέση στάθμευσης, σταθερή αρχική θέση πράκτορα, άμεση στάθμευση*: πρόκειται για την 1^η^ περίπτωση που είδαμε προηγούμενως, με την πρόσθετη διευκόλυνση του άμεσου παρκαρίσματος, δηλαδή τη θεώρηση ότι ο πράκτορας έχει παρκάρει επιτυχώς, μόλις εισέλθει στο παραλληλόγραμμο της θέσης στάθμευσης, χωρίς να απαιτείται κάποιο χρονικό διάστημα ακινησίας. Το επίπεδο αυτό, χρησιμοποιήθηκε απλά ως μία απόδειξη της σωστής λειτουργίας του αλγορίθμου (*proof of concept*), δηλαδή προκειμένου να μας επιβεβαιώσει, ότι ο αλγόριθμος υλοποιήθηκε σωστά και έτσι, ο πράκτορας είναι σε θέση να μάθει χρήσιμες συμπεριφορές.
- **Επίπεδο δυσκολίας 2** - *Ημι-τυχαία θέση στάθμευσης, τυχαία αρχική θέση πράκτορα, άμεση στάθμευση*: σε αυτό το επίπεδο δυσκολίας η επιλογή της ελεύθερης θέσης στάθμευσης χαρακτηρίζεται ως ημι-τυχαία. Αυτό σημαίνει πως ακολουθεί την επιλογή της αρχικής θέσης του πράκτορα. Συγκεκριμένα, όταν ο πράκτορας ξεκινάει από το πάνω τμήμα του χάρτη του παιχνιδιού, τότε επιλέγεται ως ελεύθερη θέση μία από τις 5 πάνω θέσεις στάθμευσης. Αντίστοιχα, όταν ο πράκτορας ξεκινάει από το κάτω τμήμα του χάρτη, τότε επιλέγεται ως ελεύθερη θέση μία από τις 5 κάτω θέσεις στάθμευσης. Το επίπεδο αυτό, εξετάζει την ικανότητα γενίκευσης του πράκτορα, σε μία ευκολότερη εκδοχή του παιχνιδιού, όπου ο στόχος του βρίσκεται πιο κοντά στην αρχική του θέση.
- **Επίπεδο δυσκολίας 3** - *Τυχαία θέση στάθμευσης, τυχαία αρχική θέση πράκτορα, άμεση στάθμευση*: σε αυτό το επίπεδο δυσκολίας, η επιλογή της ελεύθερης θέσης στάθμευσης, καθώς και η αρχική θέση του πράκτορα είναι τυχαίες. Επομένως, εξετάζεται πλήρως η ικανότητα γενίκευσης του πράκτορα, ανεξάρτητα από την αρχική του απόσταση από την ελεύθερη θέση στάθμευσης. Ωστόσο, η ικανότητα που μαθαίνει ο πράκτορας σε αυτό το επίπεδο δυσκολίας, δεν μπορεί να χαρακτηριστεί ακόμα ως στάθμευση, καθώς δεν παίζει ρόλο η ταχύτητα του αυτοκινήτου, παρά μόνο η θέση και ο προσανατολισμός του. Επομένως, πρόκειται περισσότερο για μία περίπτωση μετακίνησης από το σημείο Α στο σημείο Β, όπου τα σημεία Α και Β είναι τυχαία, με την επιπλέον δυσκολία πως ο προσανατολισμός του αυτοκινήτου πρέπει να είναι συγκεκριμένος στο σημείο Β (ώστε να εισέλθει το αυτοκίνητο εντός του παραλληλογράμμου).
- **Επίπεδο δυσκολίας 4** - *Τυχαία θέση στάθμευσης, τυχαία αρχική θέση πράκτορα, κανονική στάθμευση*: σε αυτό το επίπεδο δυσκολίας, πέραν της πλήρους γενίκευσης του πράκτορα, εφαρμόζεται και ο πραγματικός ορισμός της στάθμευσης, εισάγωντας την έννοια της ακινησίας του αυτοκινήτου, για το τυπικό, χρονικό διάστημα των 2 δευτερολέπτων. 

Στην πράξη, χρησιμοποιήθηκαν κι άλλες παραλλαγές των παραπάνω επιπέδων δυσκολίας, όμως αυτά αποδείχθηκαν τα πιο χρήσιμα, για την επιτυχή εκπαίδευση των πρακτόρων. 