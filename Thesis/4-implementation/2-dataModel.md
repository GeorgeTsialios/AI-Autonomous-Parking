## Μοντέλο δεδομένων {#sec:implementation:dataModel}

Όπως αναφέρθηκε στην Ενότητα @sec:implementation:mvvm, το πλεονέκτημα της αρχιτεκτονικής MVVM είναι η πλήρης ανεξαρτησία του front-end από το back-end. Παρ' όλα αυτά, η άψογη διαλειτουργικότητα προϋποθέτει τη συμβατότητα των δεδομένων που μεταφέρονται σε όλα τα τμήματα της εφαρμογής. Για τον σκοπό αυτό, το Model πρέπει να υλοποιεί ένα interface, το οποίο περιγράφει το μοντέλο δεδομένων, με βάση το οποία τα δεδομένα αποθηκεύονται στη βάση δεδομένων και διακινούνται σε όλη την εφαρμογή.

Για τη σχεδίαση του μοντέλου δεδομένων της εφαρμογής **Horario**, κατασκευάζουμε ένα **Διάγραμμα Οντοτήτων-Συσχετίσεων (Entity-Relationship Diagram)**, το οποίο παρουσιάζεται στην Εικόνα @fig:implementation:dataModel:erd. Το Διάγραμμα Οντοτήτων-Συσχετίσεων αποτελεί μία αναπαράσταση των τύπων δεδομένων που αποθηκεύονται σε μία βάση δεδομένων, καθώς και τις σχέσεις που αυτοί έχουν μεταξύ τους. Κάθε **οντότητα (entity)** παριστάνεται με ένα ορθογώνιο πλαίσιο, ενώ κάθε **συσχέτιση (relationship)** με έναν ρόμβο. Η κάθε οντότητα περιλαμβάνει **χαρακτηριστικά (attributes)**, τα οποία παριστάνονται με ελλείψεις και τα οποία περιγράφουν τις ιδιότητες καθενός αντικειμένου της οντότητας.

Η κάθε οντότητα συνήθως ορίζεται μονοσήμαντα από ένα ή περισσότερα χαρακτηριστικά της, τα οποία είναι μοναδικά και ονομάζονται **πρωτεύον κλειδί (primary key)** της οντότητας. Τα χαρακτηριστικά που απαρτίζουν ένα πρωτεύον κλειδί σημειώνονται υπογραμμισμένα εντός της έλλειψης. Ένα χαρακτηριστικό μπορεί να λάβει περισσότερες από μία τιμές, οπότε ονομάζεται πλειότιμο χαρακτηριστικό (multivalued attribute) και παριστάνεται με δύο γραμμές στην περιφέρεια της έλλειψης. Ένα χαρακτηριστικό μπορεί να είναι προαιρετικό, ώστε κάποια αντικείμενα της οντότητας να μην λάβουν τιμή για αυτό. Ένα προαιρετικό (optional) χαρακτηριστικό παριστάνεται με μία διακεκομμένη γραμμή που ενώνει την έλλειψη με το ορθογώνιο πλαίσιο της οντότητας.

Μία συσχέτιση περιγράφει τη σχέση που υπάρχει μεταξύ δύο ή περισσότερων οντοτήτων. Η πληθικότητα (cardinality) της συσχέτισης ορίζει τον αριθμό των στιγμιοτύπων της οντότητας που συνδέονται με την άλλη οντότητα μέσω της συσχέτισης. Μία συσχέτιση μπορεί επίσης να περιλαμβάνει χαρακτηριστικά (attributes), τα οποία περιγράφουν ιδιότητες της συσχέτισης μεταξύ αντικειμένων της κάθε συμπεριλαμβανομένης οντότητας. Η πληθικότητα σε κάθε άκρο της συσχέτισης μπορεί να λάβει τις τιμές:

- 0 έως 1: απαιτείται το πολύ ένα αντικείμενο της οντότητας για τη συσχέτιση.
- 1 έως 1: απαιτείται ακριβώς ένα αντικείμενο της οντότητας για τη συσχέτιση.
- 0 έως πολλά: απαιτείται οσοσδήποτε αριθμός αντικειμένων της οντότητας για τη συσχέτιση.
- 1 έως πολλά: απαιτείται τουλάχιστον ένα αντικείμενο της οντότητας για τη συσχέτιση.

Μία οντότητα χαρακτηρίζεται **ασθενής οντότητα (weak entity)** και παριστάνεται με μία διπλή γραμμή στο περίγραμμα του ορθογωνίου πλαισίου της, όταν κάθε αντικείμενό της δεν ορίζεται μονοσήμαντα από ένα πρωτεύον κλειδί, αλλά, αντίθετα, ορίζεται μονοσήμαντα από ένα αντικείμενο μίας άλλης -ισχυρής- οντότητας, μέσω μίας συσχέτισης, η οποία ονομάζεται **ασθενής συσχέτιση (weak relationship)** και παριστάνεται με μία διπλή γραμμή στο περίγραμμα του ρόμβου της.

Τέλος, μία οντότητα μπορεί να εξειδικεύεται σε επιμέρους οντότητες μέσω μίας **διαζευκτικής (disjoint)** σχέσης. Η διάζευξη παριστάνεται με έναν κύκλο με το γράμμα "d", στον οποίο η γενική οντότητα συνδέεται με μία γραμμή, ενώ η κάθε ειδική οντότητα με μία γραμμή, τεμνόμενη από μία καμπύλη.

Ο ενδιαφερόμενος γύρω από θέματα σχεδίασης βάσεων δεδομένων αναγνώστης μπορεί να ανατρέξει για περισσότερες λεπτομέρειες σε σχετικά συγγράμματα, όπως το [@Elmasri2015] και το [@Silberschatz2010].

Θα εφαρμόσουμε τα παραπάνω για να περιγράψουμε το Διάγραμμα Οντοτήτων-Συσχετίσεων της Εικόνας @fig:implementation:dataModel:erd. Μπορούμε να χωρίσουμε νοητά το Διάγραμμα στο άνω και κεντρικό τμήμα του, το οποίο περιγράφει έναν οργανισμό, τη διαχείρισή του και τους εργαζομένους του, και στο κάτω τμήμα του, το οποίο εστιάζει στον χρονοπρογραμματισμό της εργασίας για τον συγκεκριμένο οργανισμό.

Έτσι, έχουμε τις οντότητες *Organization*, *Location*, *Team* και *Employee* και τις μεταξύ τους συσχετίσεις, οι οποίες περιγράφουν την οργάνωση του οργανισμού. Κάθε οργανισμός αποτελείται από οποιονδήποτε αριθμό τοποθεσιών (καθεμία από τις οποίες ανήκει σε έναν μόνο οργανισμό) και κάθε τοποθεσία περιλαμβάνει οποιονδήποτε αριθμό από ομάδες (καθεμία από τις οποίες ανήκει σε μία μόνο τοποθεσία). Ο κάθε οργανισμός απασχολεί οποιονδήποτε αριθμό εργαζομένων (καθένας από τους οποίους ανήκει σε έναν μόνο οργανισμό). Επίσης, η κάθε ομάδα στελεχώνεται από οποιονδήποτε αριθμό εργαζομένων, καθένας από τους οποίους εργάζεται σε οποιονδήποτε αριθμό ομάδων. Ακόμη, η κάθε ομάδα διευθύνεται από τουλάχιστον έναν εργαζόμενο, ενώ ο κάθε εργαζόμενος μπορεί να διευθύνει οποιονδήποτε αριθμό ομάδων. Ο κάθε εργαζόμενος είναι προσβάσιμος από έναν λογαριασμό στην εφαρμογή, ενώ ο κάθε λογαριασμός μπορεί να έχει πρόσβαση σε οποιονδήποτε αριθμό εργαζομένων.

Στη συνέχεια, έχουμε τις οντότητες *Shift Rule* και *Shift Type*. Η κάθε ομάδα του οργανισμού οργανώνεται σε οποιονδήποτε αριθμό τύπων βαρδιών (καθένας από τους οποίους ανήκει σε μία μόνο ομάδα). Η ανάθεση του κάθε εργαζόμενου σε έναν τύπο βαρδιών περιορίζεται από οποιονδήποτε αριθμό κανόνων βαρδιών (καθένας από τους οποίους αντιστοιχίζεται σε έναν μόνο εργαζόμενο, από τον οποίο ορίζεται και μονοσήμαντα - ασθενής οντότητα). Ο κάθε εργαζόμενος μπορεί να εκφράσει την προτίμησή του για οποιονδήποτε αριθμό τύπων βαρδιών και για οποιονδήποτε αριθμό συναδέλφων του, με τους αντίστοιχους συντελεστές βαρύτητας.

Έπειτα, οι οντότητες *Schedule* και *Shift Assignment* περιλαμβάνουν τα δεδομένα του χρονοπρογραμμα- τισμού της εργασίας. Το κάθε πρόγραμμα αναφέρεται σε μία μόνο ομάδα του οργανισμού (καθεμία από τις οποίες περιλαμβάνει οποιονδήποτε αριθμό προγραμμάτων) και περιλαμβάνει τουλάχιστον έναν τύπο βαρδιών της συγκεκριμένης ομάδας. Το κάθε πρόγραμμα αποτελείται από οποιονδήποτε αριθμό αναθέσεων σε βάρδιες, ενώ κάθε ανάθεση περιλαμβάνεται σε ένα μόνο πρόγραμμα. Η κάθε ανάθεση αναλαμβάνεται από έναν μόνο εργαζόμενο (καθένας από τους οποίους αναλαμβάνει οποιονδήποτε αριθμό αναθέσεων), ενώ αναφέρεται σε έναν μόνο τύπο βαρδιών (καθένας από τους οποίους σχετίζεται με οποιονδήποτε αριθμό αναθέσεων).

Τέλος, η οντότητα *Request Base* περιλαμβάνει τα δεδομένα αιτημάτων των εργαζομένων. Ο κάθε εργαζόμενος υποβάλλει οποιονδήποτε αριθμό αιτημάτων (καθένα από τα οποία υποβάλλεται από μόνο έναν εργαζόμενο) και εγκρίνει οποιονδήποτε αριθμό αιτημάτων (καθένα από τα οποία εγκρίνεται από το πολύ έναν εργαζόμενο). Η οντότητα *Request Base* εξειδικεύεται στις οντότητες *Request Time Off* και *Request Shift Exchange*. Το κάθε αίτημα ανταλλαγής βαρδιών διαθέτει ανατεθειμένη μόνο μία ανάθεση βάρδιας (καθεμία από τις οποίες μπορεί να σχετίζεται με οποιονδήποτε αριθμό αιτημάτων ανταλλαγής βαρδιών) και καθορίζει ως προτιμώμενη μόνο μία, διαφορετική, ανάθεση βάρδιας (καθεμία από τις οποίες μπορεί επίσης να σχετίζεται με οποιονδήποτε αριθμό αιτημάτων ανταλλαγής βαρδιών).

![Το Διάγραμμα Οντοτήτων-Συσχετίσεων για την εφαρμογή Horario](4-implementation/figures/erd.pdf){#fig:implementation:dataModel:erd}
