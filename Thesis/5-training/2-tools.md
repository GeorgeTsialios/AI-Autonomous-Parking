## Εργαλεία {#sec:training:tools}

Τα εργαλεία που χρησιμοποιήθηκαν για τις εκπαιδεύσεις των πρακτόρων παρουσιάζονται στην *Εικόνα @fig:training:tools:tools*. Στη συνέχεια, ακολουθεί μία σύντομη παρουσίαση του καθενός, καθώς και περιγραφή του τρόπου με τον οποίο αξιοποιήθηκε στην εργασία.

![Εργαλεία εκπαίδευσης.](5-training/figures/tools.png){#fig:training:tools:tools width=85%}

### Gymnasium {#sec:training:tools:gymnasium}

Η βιβλιοθήκη [OpenAI Gymnasium](https://gymnasium.farama.org/), έχει αναλυθεί στην *Ενότητα @sec:game:reason* ως ένα σημαντικό εργαλείο για την ανάπτυξη και σύγκριση αλγορίθμων ενισχυτικής μάθησης. Πέραν όμως, από τη μεγάλη ποικιλία περιβαλλόντων και μεθόδων που πάρεχει η βιβλιοθήκη, το μεγαλύτερο πλεονέκτημα που προσφέρει η χρήση της, είναι η δυνατότητα εκτέλεσης του περιβάλλοντος χωρίς γραφικά (*renderless*). Αυτό είναι ιδιαίτερα χρήσιμο στη διαδικασία της εκπαίδευσης, καθώς μειώνει σε μεγάλο βαθμό το υπολογιστικό κόστος και επιταχύνει τη διάρκεια του κάθε επεισοδίου. Για παράδειγμα στην περίπτωση μας, ο πραγματικός χρόνος ενός επεισοδίου του παιχνιδιού είναι 30s, ενώ ο χρόνος εκτέλεσης του περιβάλλοντος χωρίς γραφικά μετρήθηκε στα 0.13s. Επομένως, χρησιμοποιώντας αυτή την ιδιότητα της βιβλιοθήκης OpenAI Gymnasium, η εκπαίδευση γίνεται 231 φορές πιο γρήγορη.

Ωστόσο, μπορεί να απαιτείται προσαρμογή διαφόρων παραμέτρων του παιχνιδιού για εκτέλεση χωρίς γραφικά. Για παράδειγμα, πρέπει να αποφευχθούν χρονικές συνθήκες εντός του παιχνιδιού, επειδή αυτό πλέον θα εκτελείται πολύ πιο γρήγορα. Έτσι, ένα λάθος που κάναμε στις πρώτες εκπαιδεύσεις, ήταν η χρήση της χρονικής συνθήκης των 2 δευτερολέπτων για την επιτυχή στάθμευση του πράκτορα. Προφανώς, αυτό δεν ήταν πλέον εφικτό, καθώς το κάθε επεισόδιο είχε πλέον διάρκεια περίπου 0.13s. Για αυτό, προσαρμόσαμε τη συνθήκη αυτή, ώστε να ελέγχεται το πλήθος των βημάτων στα οποία ο πράκτορας βρίσκεται ακίνητος εντός της θέσης στάθμευσης και όχι ο αντίστοιχος χρόνος. 

### Numpy {#sec:training:tools:numpy}

Η [Numpy](https://numpy.org/) είναι μία δημοφιλής βιβλιοθήκη της Python για επιστημονικούς υπολογισμούς. Βασικό της χαρακτηριστικό αποτελεί η υποστήριξη για μεγάλους, πολυδιάστατους πίνακες (*arrays*), καθώς και η παροχή διαφορών μαθηματικών συναρτήσεων για την αποδοτική επεξεργασία αυτών των πινάκων. Επομένως, η Numpy χρησιμοποιήθηκε σε αυτήν την εργασία για την αποθήκευση και την ενημέρωση του πίνακα Q.

### Stable-Baselines3 {#sec:training:tools:stable-baselines3}

Η [Stable-Baselines3](https://stable-baselines3.readthedocs.io/en/master/) είναι μία βιβλιοθήκη της Python, που χρησιμοποιείται για την εκπαίδευση πρακτόρων ενισχυτικής μάθησης. Συγκεκριμένα, αποτελεί μία συλλογή αξιοπίστων υλοποιήσεων, σύγχρονων αλγορίθμων ενισχυτικής μάθησης. Αξίζει να τονιστεί η αξιοπιστία των υλοποιήσεων αυτών, αφού τα αποτελέσματα τους έχουν συγκριθεί με αυτά από τις αρχικές δημοσιεύσεις των αλγορίθμων. Αυτό είναι πολύ σημαντικό, καθώς όπως αναφέρεται και στο [@amidLessonsLearned], η ενισχυτική μάθηση είναι αρκετά ασταθής, με πολλούς παράγοντες που μπορεί να προκαλέσουν την αποτυχία μίας εκπαίδευσης. Επομένως, χρησιμοποιώντας μία υλοποίηση αλγορίθμου που έχει αποδειχθεί ότι λειτουργεί, αφαιρείται μία πιθανή πηγή σφάλματος.

Ακόμα, η βιβλιοθήκη είναι γνωστή για τη φιλική προς την χρήστη διεπαφή της. Θα μπορούσαμε να πούμε πως αποτελεί την αντίστοιχη βιβλιοθήκη της SciKit Learn, για τον τομέα της ενισχυτικής μάθησης, αφού και οι δύο βιβλιοθήκες διακρίνονται για την ευκολία χρήσης τους. Επομένως, η Stable-Baselines3 επιλέχθηκε σε αυτήν την εργασία έναντι άλλων, δημοφιλών επιλογών όπως η PyTorch ή το TensorFlow, διότι θεωρείται η ιδανική επιλογή για αρχάριους στον τομέα της ενισχυτικής νοημοσύνης και για εργασίες, όπου ο κύριος στόχος είναι η εφαρμογή υπαρχόντων αλγορίθμων, παρά η ανάπτυξη νέων.

Κατά την εκπαίδευση των πρακτόρων, η βιβλιοθήκη παρέχει τη δυνατότητα αποθήκευσης του πράκτορα σε ένα αρχείο .zip, ανά ένα καθορισμένο αρχικό βημάτων. Αυτό το αρχείο .zip δεν περιέχει απλώς τα βάρη του νευρωνικού δικτύου, αλλά και την αρχιτεκτονική του, τις ρυθμίσεις του αλγορίθμου, καθώς και πληροφορίες του περιβάλλοντος. Με αυτόν τον τρόπο, εξασφαλίζεται ότι το εκπαιδευμένο μοντέλο μπορεί να φορτωθεί ξανά στο μέλλον για συνέχιση της εκπαίδευσης του ή για αξιολόγηση. Το μέγεθος του αρχείου εξαρτάται από το μέγεθος του νευρωνικού δικτύου, καθώς και τον αλγόριθμο εκπαίδευσης. Στην περίπτωση μας, υπό σταθερή αρχιτεκτονική δικτύου, προέκυψαν τα εξής μεγέθη αρχείων για τους αλγορίθμους που χρησιμοποιήθηκαν, τα οποία αποτελούν μία καλή ένδειξη της πολυπλοκότητας και του κόστους κάθε αλγορίθμου:

- PPO: 0.156 MB
- SAC: 3.054 MB
- DDPG: 3.985 MB
- TD3: 5.971MB

Επιπλέον, αξίζει να σημειωθεί πως η βιβλιοθήκη Stable-Baselines3 χρησιμοποιεί διανυσματοποιημένα περιβάλλοντα (*vectorized environments*). Τα διανυσματοποιημένα περιβάλλοντα είναι μία μέθοδος που επιτρέπει την εκπαίδευση ενός πράκτορα ενισχυτικής μάθησης σε πολλαπλά ανεξάρτητα περιβάλλοντα, ταυτόχρονα. Έτσι, αξιοποιούνται καλύτερα πόροι του υλικού όπως οι πολυπύρηνοι επεξεργαστές και επιταχύνεται η διαδικασία της εκπαίδευσης. Υπάρχουν δύο ειδών διανυσματοποιημένα περιβάλλοντα στη βιβλιοθήκη Stable-Baselines3:

- Το DummyVecEnv, το οποίο εκτελεί τα περιβάλλοντα σειριακά και
- Το SubprocVecEnv, το οποίο εκτελεί τα περιβάλλοντα παράλληλα, σε διαφορετικές διεργασίες.

Στην περίπτωση μας, έγινε προσπάθεια για αξιοποίηση του περιβάλλοντος SubprocVecEnv, προκειμένου να αυξηθεί η απόδοση της εκπαίδευσης. Ωστόσο, αυτό δεν κατέστη δυνατό, λόγω της χρήσης της βιβλιοθήκης Pygame για την ανάπτυξη του παιχνιδιού. Συγκεκριμένα, η Pygame δεν είναι συμβατή με την διαδικασία της σειριοποίησης των αντικειμένων της, που απαιτείται για την αποστολή τους σε διαφορετικές διεργασίες. Επομένως ,χρησιμοποιήθηκε το απλούστερο περιβάλλον DummyVecEnv, το οποίο παρά το όνομα του, είναι προτιμότερο σε απλά περιβάλλοντα, όπου ο φόρτος της πολυδιεργασίας υπερισχύει του χρόνου εκτέλεσης του περιβάλλοντος.

Τέλος, είναι εξαιρετικά χρήσιμη η εύκολη ενσωμάτωση της βιβλιοθήκης Stable-Baselines3 με τη βιβλιοθήκη OpenAI Gymnasium, καθώς και με το εργάλειο TensorBoard, το οποίο είναι το επόμενο εργαλείο που θα αναλυθεί.

### TensorBoard {#sec:training:tools:tensorboard}

Το [Tensorboard](https://www.tensorflow.org/tensorboard) είναι ένα εργαλείο οπτικοποίησης που χρησιμοποιείται με διάφορες βιβλιοθήκες μηχανικής μάθησης για την παρακολούθηση της διαδικασία εκπαίδευσης. Προσφέρει τη σχεδίαση γραφημάτων διαφόρων χρήσιμων μετρικών, όπως τη μέση ανταμοιβή του πράκτορα ανά επεισόδιο (*ep_rew_mean*), το μέσο μήκος επεισοδίου (*ep_len_mean*), το σφάλμα της πολιτικής (*policy_loss*), ο ρυθμός μάθησης (*learning_rate*) κ.ά. Αυτό είναι ιδιαίτερα χρήσιμο κατά τη διάρκεια της εκπαίδευσης, καθώς επιτρέπει την παρακολούθηση της εξέλιξης του πράκτορα και την ανίχνευση προβλημάτων στην εκπαίδευση. Μάλιστα, τα γραφήματα ανανεώνονται αυτόματα ανά τακτά χρονικά διαστήματα, ενώ προσφέρεται η δυνατότητα σύγκρισης των μετρικών μεταξύ διαφορετικών εκπαιδεύσεων. Έτσι, βοηθάει τους σχεδιαστές συστημάτων μηχανικής μάθησης να αναγνωρίσουν πιο γρήγορα τυχόν σφάλματα της εκπαίδευσης και να κατανοήσουν καλύτερα τις αιτίες τους. 

Στην περίπτωση μας, οι μετρικές της μέσης ανταμοιβής και του μέσου ποσοστού επιτυχίας του πράκτορα ήταν οι πιο χρήσιμες για την παρακολούθηση της πορείας της εκπαίδευσης και βοήθησαν σε μεγάλο βαθμό στη βελτίωση της απόδοσης των πρακτόρων. Ακόμα, αξιοποιήθηκε το χαρακτηριστικό του Tensorboard που επιτρέπει τη ρύθμιση του βαθμού εξομάλυνσης των γραφικών. Με τον τρόπο αυτό, οι γραφικές παραστάσεις των μετρικών γίνονται πιο ευανάγνωστες και παρέχεται καλύτερη πληροφορία για την τάση τους, χωρίς να αποπροσανατολίζεται κάποιος από τις συχνές βυθίσεις και μέγιστα.

### Colaboratory {#sec:training:tools:colaboratory}

Το [Colaboratory](https://colab.research.google.com/) (ή *Colab*) είναι μία δωρεάν πλατφόρμα νέφους (*cloud*) της Google για την εκτέλεση κώδικα Python σε περιβάλλον τύπου Jupyter notebook. Παρέχει πρόσβαση σε ισχυρές υπολογιστικές μονάδες, όπως οι μονάδες επεξεργασίας γραφικών (GPU) και οι μονάδες επεξεργασίας τανυστών (TPU), καθιστώντας το έτσι ιδανικό για εργασίες μηχανικής και βαθιάς μάθησης. Το όνομα της πλατφόρμας παραπέμπει στη συνεργασία μεταξύ των ερευνητών, η οποία γίνεται δυνατή μέσω των χαρακτηριστικών της συνεργατικής επεξεργασίας σημειωμάτων Jupyter, καθώς και της αποθήκευσης τους στο Google Drive. 

Ωστόσο, στη δωρεάν έκδοση του Colab, η πρόσβαση σε ακριβούς πόρους όπως οι GPU είναι είτε ανύπαρκτη ή πολύ περιορισμένη, ενώ τίθενται χρονικά όρια στη διάρκεια εκτέλεσης (*runtime*) των σημειωμάτων. Συγκεκριμένα, ο κάθε χρήστης έχει στη διάθεση του καθημερινά κάποιες υπολογιστικές μονάδες (*compute units*), οι οποίες αποτελούν μία μορφή συναλλάγματος. Όσο πιο ακριβό το υλικό που χρησιμοποιεί ο χρήστης, τόσο γρηγορότερα εξαντλούνται οι μονάδες του. Μέσω μίας μηνιαίας συνδρομής, ο χρήστης μπορεί να αγοράσει περισσότερες υπολογιστικές μονάδες, να αποκτήσει πρόσβαση σε καλύτερους πόρους και να έχει μεγαλύτερη διάρκεια εκτέλεσης των σημειωμάτων του. 

Στην περίπτωση μας, κρίθηκε αναγκαία η αγορά μίας συνδρομής Colab Pro, η οποία κοστίζει 11.45€, καθώς χρησιμοποιώντας τη δωρεάν έκδοση, η χρήση GPU κατανάλωνε όλες τις ημερήσιες υπολογιστικές μονάδες σε μόλις μία ώρα. Το πρόβλημα όμως είναι, πως η ενισχυτική μάθηση είναι ιδιαίτερα μη αποδοτική στη χρήση πόρων, με τις εκπαιδεύσεις να χρειάζονται πολύ χρόνο για να ολοκληρωθούν. Έτσι, οι εξαγορασμένες υπολογιστικές μονάδες εξαντλήθηκαν σε μόλις μία εβδομάδα. Επομένως, παρόλο που η πλατφόρμα μας επέτρεξε την διεξαγωγή εκπαιδεύσεων σε καλύτερα μηχανήματα, η πρόσβαση σε αυτά δεν διήρκησε πολύ. Το πρόβλημα των ακριβών υπηρεσίων νέφους εντοπίζεται και στο άρθρο του [amidLessonsLearned], όπου ο συγγραφέας περιγράφει τις εμπειρίες και τα συμπεράσματα του από την εκπόνηση ενός έργου ενισχυτικής μάθησης, αναφέροντας χαρακτηριστικά πως ξόδεψε περίπου 850$ σε διάστημα 8 μηνών για τις ανάγκες της εκπαίδευσης.

### Github {#sec:training:tools:github}

Το [Github](https://github.com/) είναι μία πλατφόρμα ελέχου έκδοσης λογισμικού ανάπτυξης. Χρησιμοποιείται από προγραμματιστές για την αποθήκευση και διαχείριση του κώδικα τους σε αποθετήρια (*repositories*), την παρακολούθηση των αλλαγών που γίνονται σε αυτόν και τη συνεργασία με άλλους προγραμματιστές σε έργα λογισμικών. Έτσι, το Github αξιοποιήθηκε στην περίπτωση μας για τη δημιουργία ενός αποθετηρίου αποθήκευσης του κώδικα, καθώς και των υπολοίπων αρχείων της εργασία. Αποδείχθηκε εξαιρετικά χρήσιμο, καθώς, όπως θα δούμε και στην υποενότητα @sec:training:compute του υλικού, χρησιμοποιήθηκαν διαφορετικοί υπολογιστές για την εκπαίδευση των πρακτόρων. Έτσι, το Github απλοποίησε την επικοινωνία μεταξύ τους, επιτρέποντας την αποθήκευση όλων των αρχείων σε ένα κοινό σημείο αναφοράς και διευκολύνοντας τον συγχρονισμό τους. 